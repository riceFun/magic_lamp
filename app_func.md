# 个人项目积分管理App - 功能设计文档

## 1. 应用概述

**应用名称**: Magic Lamp (神灯积分管理)

**核心理念**: 通过积分激励系统，帮助用户管理个人任务和项目，养成良好习惯，实现目标。

**目标用户**: 儿童用户（通过游戏化方式培养良好习惯）+ 家长管理员

**UI设计风格**: 活泼、可爱、有趣（适合儿童使用）

## 2. 核心功能模块

### 2.1 启动与登录
- **启动页**: 应用启动时的欢迎页面（展示Logo、应用名称）
- **登录页**: 用户身份验证
  - 首次使用：创建账户（用户名/昵称、密码）
  - 已有账户：输入密码进入
  - 支持多用户切换
  - 用户角色：管理员/普通用户（家长模式）

### 2.2 积分系统

**积分设计理念**：
- 模拟"工作-收入-消费"的经济概念
- 每日目标：200-400分（类似成年人每天的工资）
- 兑换比例：10积分 = 1元人民币（帮助孩子理解价值）

**功能模块**：
- **积分展示**: 首页显示当前总积分（可为负数）
- **积分获取**:
  - 任务完成奖励（仅奖励，不惩罚）
  - 连续完成额外奖励
  - 管理员手动奖励
- **积分消耗**:
  - 兑换商城购物
  - 预支积分（需支付利息）
  - 管理员手动扣除
- **积分历史**: 查看积分变动记录（时间、类型、数量、原因）
- **积分统计**:
  - 按项目维度统计积分获得情况
  - 用于分析和调整任务难易度及积分奖励数值
- **等级系统**: 根据累计获得积分计算用户等级
- **称号系统**: 根据成就和里程碑解锁称号
- **目标设定**:
  - 设定积分目标（日/周/月目标）
  - 目标进度展示
  - 目标完成提醒
- **预支积分**:
  - 允许用户预支积分（即使当前积分为负）
  - 预支利息：月利率10%，单利计算
  - 记录预支本金、利息、还款记录

### 2.3 任务管理
- **任务创建**:
  - 任务名称、描述
  - 完成奖励积分
  - 任务类型（一次性/每日/每周/每月）
  - 截止时间/提醒时间
  - 优先级标记
  - 任务标签（支持多标签）
  - 任务进度（0-100%）

- **任务操作**:
  - 标记完成（自动增加积分）
  - 更新进度
  - 编辑任务（需管理员权限）
  - 删除任务（需管理员权限）
  - 从模板创建任务

- **任务状态**:
  - 待完成
  - 进行中
  - 已完成
  - 已过期（过期不扣分，仅标记状态）

- **重复任务奖励**:
  - 连续完成天数统计
  - 连续完成额外奖励（如：连续7天+10分，连续30天+50分）

- **任务标签系统**:
  - 创建、编辑、删除标签
  - 为任务添加多个标签
  - 按标签筛选任务

- **任务模板**:
  - 保存常用任务为模板
  - 快速从模板创建新任务
  - 管理模板库（编辑、删除）

### 2.4 项目管理
- **项目创建**:
  - 项目名称、描述
  - 项目图标/颜色
  - 关联任务列表

- **项目分类**: 可自定义分类（如：学习、健身、工作、生活等）
- **项目统计**: 每个项目的积分贡献统计
- **项目操作**: 编辑、删除、归档

### 2.5 兑换商城系统

**商城设计理念**：
- 类似真实购物商城，增加儿童兑换欲望
- 积分换算：10积分 = 1元人民币（帮助孩子理解商品价值）
- 让孩子学会"储蓄-消费"的财务规划
- **寓教于乐**：每个商品关联一个成语或优秀英文词汇，兑换时学习知识

**商品命名规则**：
- 每个商品设置对应的成语或英文词汇作为"代号"
- 商品展示时同时显示商品名和词汇代号
- 兑换时展示词汇含义、读音、例句等
- 成语示例：一帆风顺、锦上添花、马到成功、书香门第等
- 英文词汇示例：Excellent、Achievement、Brilliant、Courage等
- 让孩子在兑换过程中潜移默化学习文化知识

**功能模块**：
- **商城展示**:
  - 类似购物商城的界面设计
  - 奖励商品卡片展示（图片、名称、词汇代号、所需积分、对应价值）
  - 商品分类（玩具、零食、特权、活动等）
  - 热门推荐、限时特惠区域
  - 我的积分余额醒目显示

- **奖励库管理**（管理员功能）:
  - 创建奖励商品（名称、描述、图片、所需积分）
  - 设置词汇代号（成语或英文词汇）
  - 填写词汇含义、读音、例句
  - 选择词汇类型（成语/英文）
  - 设置商品分类
  - 设置库存数量（可选）
  - 上架/下架商品
  - 设置为热门或特惠
  - 参考定价建议：
    - 小奖励：50-200分（约5-20元）
    - 中等奖励：200-1000分（约20-100元）
    - 大奖励：1000-5000分（约100-500元）
    - 特权奖励：100-500分

- **兑换操作**:
  - 浏览商品列表
  - 查看商品详情（包含词汇学习卡片）
  - 学习词汇含义和用法
  - 加入购物车（可选功能）
  - 立即兑换
  - 积分不足提醒
  - 兑换成功动画和提示
  - **兑换后词汇复习**：展示本次学到的词汇
  - 查看兑换记录
  - 显示已兑换次数
  - **我的词汇库**：查看通过兑换学到的所有词汇

- **兑换记录**:
  - 兑换历史列表
  - 显示兑换时间、商品、消耗积分、学习的词汇
  - 兑换状态（待发放/已发放）

### 2.6 其他积分操作
- **手动调整**: 手动增加/减少积分（需填写原因，仅管理员）
- **积分罚款**: 自定义扣分项目（如：熬夜、拖延等，仅管理员）
- **积分奖励**: 自定义加分项目（如：早起、读书等，仅管理员）

### 2.7 权限管理（家长模式）
- **用户角色**:
  - 管理员：完全权限
  - 普通用户：只读权限

- **管理员权限**:
  - 创建、编辑、删除任务
  - 创建、编辑、删除项目
  - 手动增加/扣除积分
  - 编辑任务奖励和惩罚积分
  - 数据备份与恢复
  - 用户管理

- **普通用户权限**:
  - 查看所有数据
  - 标记任务完成/失败
  - 更新任务进度
  - 兑换奖励（消耗积分）

### 2.8 数据管理
- **数据备份**:
  - 手动备份数据库到本地文件
  - 自动备份（可设置频率）

- **数据恢复**:
  - 从备份文件恢复数据
  - 恢复前数据预览

- **多用户支持**:
  - 支持多个用户账户
  - 用户数据独立存储

- **数据同步**（预留功能）:
  - 预留云端同步接口
  - 支持跨设备数据同步

### 2.9 页面结构设计

#### 底部导航栏（5个Tab）+ PageView

**技术实现**：
- 使用 PageView 组件展示5个页面
- 支持左右滑动切换页面
- 底部导航栏与 PageView 联动
- 点击导航栏切换页面，滑动页面更新导航栏状态

**Tab 1: 首页** 🏠
- 当前用户信息（头像、昵称、等级、称号）
- 当前总积分（大字号显示，醒目）
- 积分目标进度（日/周/月目标卡片）
- 待完成任务列表（按优先级和截止时间排序）
- 项目快捷入口（显示各项目图标）
- 快速操作按钮（创建任务等）

**Tab 2: 兑换** 🛒
- 我的积分余额（顶部醒目显示）
- **我的词汇库入口**（查看已学词汇）
- 商品分类导航
- 热门推荐区域
- 限时特惠区域
- 商品列表（卡片式展示）
  - 商品图片
  - 商品名称
  - **词汇代号**（醒目显示）
  - 所需积分
  - 立即兑换按钮
- 我的兑换记录入口

**Tab 3: 历史** 📜
- 积分变动记录
  - 时间线展示
  - 显示类型、数量、原因、关联任务/项目
  - 支持按时间、类型筛选
- 已完成任务历史
- 连续完成记录展示

**Tab 4: 统计** 📊
- 项目维度积分统计
  - 按项目展示积分贡献
  - 简单的进度条或数值展示
  - 卡片式展示各项目数据
- 积分获得趋势（简单展示）
- 任务完成率统计
- 连续完成天数排行
- 等级进度展示

**Tab 5: 设置** ⚙️
- 个人资料（头像、昵称、等级、称号管理）
- 项目管理（创建、编辑、删除项目）
- 任务标签管理
- 任务模板管理
- 奖励商城管理（仅管理员）
- 目标设定
- 数据备份与恢复（仅管理员）
- 用户管理（仅管理员）
- 退出登录

## 3. 数据模型设计（SQLite）

### 积分系统设计示例

**每日任务配置示例**（达到200-400分/天）：
```
早上任务：
- 按时起床（7:00前）：20分
- 整理床铺：15分
- 刷牙洗脸：10分

上午任务：
- 完成作业1小时：80分
- 阅读30分钟：40分

下午任务：
- 练琴30分钟：60分
- 运动30分钟：50分

晚上任务：
- 复习功课30分钟：50分
- 整理书包：15分
- 按时睡觉（21:00前）：30分

连续完成奖励：
- 连续3天完成所有任务：+30分
- 连续7天完成所有任务：+100分

总计：基础370分/天，连续完成额外奖励
```

**商城商品定价示例**（10积分=1元）：
```
小奖励：
- 棒棒糖（5元）：50分 | 成语：一帆风顺
- 贴纸一张（10元）：100分 | 英文：Success
- 小玩具（20元）：200分 | 成语：锦上添花

中等奖励：
- 图书（30-50元）：300-500分 | 成语：书香门第 / 英文：Knowledge
- 乐高小套装（80元）：800分 | 英文：Achievement
- 文具套装（50元）：500分 | 成语：妙笔生花

大奖励：
- 游戏机（500元）：5000分 | 英文：Excellent
- 自行车（800元）：8000分 | 成语：马到成功
- 平板电脑（2000元）：20000分 | 英文：Outstanding

特权奖励：
- 看电视30分钟：100分 | 成语：劳逸结合
- 玩手机游戏1小时：300分 | 英文：Relax
- 周末外出游玩：500分 | 成语：心旷神怡
```

**词汇示例库**：

成语类（适合不同价位）：
- 低价位：一帆风顺、心想事成、如虎添翼、锦上添花、喜出望外
- 中价位：书香门第、妙笔生花、才华横溢、学富五车、博学多才
- 高价位：马到成功、大展宏图、前程似锦、鹏程万里、出类拔萃
- 特权类：劳逸结合、心旷神怡、悠然自得、怡然自乐、赏心悦目

英文词汇类（适合不同价位）：
- 低价位：Success、Happy、Bright、Smart、Joy
- 中价位：Knowledge、Achievement、Progress、Wisdom、Brilliant
- 高价位：Excellent、Outstanding、Remarkable、Magnificent、Extraordinary
- 特权类：Relax、Leisure、Enjoy、Peaceful、Freedom
```

### 3.1 表结构设计

#### users 表（用户表）
```sql
- id (主键)
- username (用户名/昵称)
- password (密码，必填)
- role (用户角色: admin/user)
- avatar (头像路径/标识，可选)
- initial_points (初始积分，默认0)
- current_level (当前等级)
- total_earned_points (累计获得积分，用于计算等级)
- current_title_id (当前使用的称号ID，外键)
- created_at (创建时间)
- last_login_at (最后登录时间)
```

#### projects 表（项目表）
```sql
- id (主键)
- user_id (用户ID，外键)
- name (项目名称)
- description (项目描述)
- icon (图标标识)
- color (颜色代码)
- category (分类)
- created_at (创建时间)
- updated_at (更新时间)
- is_archived (是否归档)
```

#### tasks 表（任务表）
```sql
- id (主键)
- project_id (关联项目ID，外键)
- title (任务标题)
- description (任务描述)
- reward_points (完成奖励积分)
- task_type (任务类型: once/daily/weekly/monthly)
- priority (优先级: low/medium/high)
- status (状态: pending/in_progress/completed/expired)
- progress (进度: 0-100)
- due_date (截止时间)
- remind_at (提醒时间)
- streak_count (连续完成次数，用于重复任务)
- last_completed_at (上次完成时间，用于判断连续性)
- created_at (创建时间)
- completed_at (完成时间)
```

#### point_records 表（积分记录表）
```sql
- id (主键)
- user_id (用户ID，外键)
- type (类型: task_reward/task_penalty/exchange/manual_add/manual_deduct/custom)
- amount (积分变动量，正数为增加，负数为减少)
- reason (原因/说明)
- related_id (关联ID，如任务ID或兑换ID)
- related_type (关联类型: task/exchange/custom)
- created_at (创建时间)
```

#### rewards 表（奖励商品表）
```sql
- id (主键)
- user_id (用户ID，外键)
- name (商品名称)
- description (商品描述)
- image_url (商品图片路径)
- cost_points (所需积分)
- reference_price (参考价值，人民币元，可选，用于展示商品实际价值)
- category (商品分类: toy/snack/privilege/activity/other)
- stock (库存数量，-1表示无限)
- is_active (是否上架)
- is_hot (是否热门推荐)
- is_special (是否限时特惠)
- sort_order (排序权重)
- word_code (词汇代号，成语或英文词汇)
- word_type (词汇类型: idiom/english)
- word_pronunciation (词汇读音，拼音或音标)
- word_meaning (词汇含义解释)
- word_example (词汇例句)
- created_at (创建时间)
- updated_at (更新时间)
```

**说明**：
- cost_points: 兑换所需积分
- reference_price: 参考价值（人民币），按 10积分=1元 的比例，可以帮助孩子理解商品价值
- word_code: 词汇代号，如"一帆风顺"、"Excellent"
- word_type: idiom（成语）或 english（英文词汇）
- word_pronunciation: 拼音（yì fān fēng shùn）或音标（/ˈeksələnt/）
- word_meaning: 词汇的含义解释
- word_example: 使用该词汇的例句

**示例数据**：
```sql
-- 成语示例
INSERT INTO rewards (name, cost_points, reference_price, word_code, word_type, word_pronunciation, word_meaning, word_example)
VALUES (
  '棒棒糖',
  50,
  5,
  '一帆风顺',
  'idiom',
  'yì fān fēng shùn',
  '比喻非常顺利，没有任何阻碍。',
  '祝你考试一帆风顺，取得好成绩！'
);

-- 英文词汇示例
INSERT INTO rewards (name, cost_points, reference_price, word_code, word_type, word_pronunciation, word_meaning, word_example)
VALUES (
  '乐高小套装',
  800,
  80,
  'Achievement',
  'english',
  '/əˈtʃiːvmənt/',
  '成就；完成',
  'Getting good grades is a great achievement.'
);
```

#### exchanges 表（兑换记录表）
```sql
- id (主键)
- user_id (用户ID，外键)
- reward_id (关联奖励ID，外键)
- points_spent (消耗积分)
- status (兑换状态: pending/completed)
- created_at (兑换时间)
- completed_at (发放时间)
```

#### tags 表（标签表）
```sql
- id (主键)
- user_id (用户ID，外键)
- name (标签名称)
- color (标签颜色)
- created_at (创建时间)
```

#### task_tags 表（任务-标签关联表）
```sql
- id (主键)
- task_id (任务ID，外键)
- tag_id (标签ID，外键)
- created_at (创建时间)
```

#### task_templates 表（任务模板表）
```sql
- id (主键)
- user_id (用户ID，外键)
- title (模板标题)
- description (模板描述)
- reward_points (奖励积分)
- task_type (任务类型)
- priority (优先级)
- created_at (创建时间)
```

#### advance_records 表（预支积分记录表）
```sql
- id (主键)
- user_id (用户ID，外键)
- principal (预支本金)
- interest_rate (利率，默认0.1，即10%)
- advance_date (预支日期)
- due_date (应还日期)
- total_repaid (已还总额)
- status (状态: active/completed)
- created_at (创建时间)
```

#### titles 表（称号表）
```sql
- id (主键)
- name (称号名称)
- description (称号描述)
- icon (称号图标)
- unlock_condition (解锁条件描述)
- unlock_type (解锁类型: level/points/streak/achievement)
- unlock_value (解锁所需数值)
- created_at (创建时间)
```

#### user_titles 表（用户称号关联表）
```sql
- id (主键)
- user_id (用户ID，外键)
- title_id (称号ID，外键)
- unlocked_at (解锁时间)
```

#### streak_records 表（连续完成记录表）
```sql
- id (主键)
- user_id (用户ID，外键)
- task_id (任务ID，外键)
- streak_count (连续次数)
- bonus_points (奖励积分)
- record_date (记录日期)
- created_at (创建时间)
```

#### goals 表（目标设定表）
```sql
- id (主键)
- user_id (用户ID，外键)
- title (目标标题)
- target_points (目标积分)
- goal_type (目标类型: daily/weekly/monthly)
- start_date (开始日期)
- end_date (结束日期)
- current_points (当前进度积分)
- status (状态: active/completed/failed)
- created_at (创建时间)
```

#### backups 表（备份记录表）
```sql
- id (主键)
- user_id (用户ID，外键，备份操作者)
- file_path (备份文件路径)
- file_size (文件大小)
- backup_type (备份类型: manual/auto)
- created_at (备份时间)
```

#### user_words 表（用户词汇库表）
```sql
- id (主键)
- user_id (用户ID，外键)
- reward_id (关联的奖励商品ID，外键)
- word_code (词汇代号)
- word_type (词汇类型: idiom/english)
- learned_at (学习时间，首次兑换该商品的时间)
- review_count (复习次数)
- last_review_at (上次复习时间)
```

**说明**：
- 用于记录用户通过兑换商品学到的词汇
- 每次兑换新商品时，自动添加该商品的词汇到用户词汇库
- 用户可以在"我的词汇库"中查看和复习所有学过的词汇
- 支持词汇复习统计

## 4. 技术栈

- **前端框架**: Flutter
- **路由管理**: go_router
- **网络请求**: dio
- **加载提示**: flutter_easyloading
- **状态管理**: provider
- **本地数据库**: sqflite (SQLite)
- **本地存储**: shared_preferences
- **事件总线**: event_bus

## 5. 待确认的功能细节

### 5.1 用户界面
- [x] 首页布局风格：**卡片式**
- [x] 主题色：**明快的蓝色**（不支持深色模式，仅浅色主题）
- [x] UI风格：**活泼、可爱、有趣**（适合儿童）
  - 主色调：明快的蓝色（如：#42A5F5、#2196F3）
  - 辅助色：明亮、鲜艳的配色（黄色、绿色、橙色等作为强调色）
  - 卡通化的图标和插图
  - 适当的动画效果和反馈
  - 可爱的字体和圆角设计
- [x] 导航方式：**底部导航栏（5个Tab）+ PageView**
  - 使用 PageView 展示5个页面
  - 支持左右滑动切换页面
  - 点击底部导航栏切换页面
  - 页面切换带平滑动画
  - Tab 1: 首页（显示积分、任务、目标）
  - Tab 2: 兑换（商城界面，商品列表、分类、兑换）
  - Tab 3: 历史（积分记录、任务历史）
  - Tab 4: 统计（项目统计、趋势、完成率）
  - Tab 5: 设置（个人、项目、标签、模板、商城管理、数据管理）
- [x] 启动页面：**需要**（展示Logo和应用名称）
- [x] 登录页面：**需要**（支持用户创建和登录）

### 5.2 积分规则
- [x] 初始积分：**0分**
- [x] 积分是否可以为负数：**可以**
- [x] 重复任务连续完成奖励：**需要**（连续天数统计+额外奖励）
- [x] 积分等级/称号系统：**需要**
- [x] 预支积分功能：**需要**（月利率10%，单利）
- [x] 积分设计原则：
  - **每日积分获取目标**：200-400分（类似成年人每天的工资）
  - **积分与人民币换算**：10积分 = 1元人民币（兑换时参考）
  - **任务奖励设计建议**：
    - 简单任务（5-15分钟）：10-30分
    - 中等任务（15-30分钟）：30-80分
    - 复杂任务（30-60分钟）：80-150分
    - 重要任务（1小时以上）：150-300分
    - 连续完成奖励：10-50分
  - **商品定价建议**：
    - 小奖励（小零食、贴纸等）：50-200分（5-20元）
    - 中等奖励（玩具、书籍等）：200-1000分（20-100元）
    - 大奖励（游戏、电子产品等）：1000-5000分（100-500元）
    - 特权奖励（看电视、玩游戏时间等）：100-500分

### 5.3 任务管理
- [x] 任务是否支持子任务：**不支持**
- [x] 任务标签系统：**需要**（支持多标签）
- [x] 任务模板功能：**需要**
- [x] 任务进度追踪：**需要**（0-100%）
- [x] 过期任务是否自动失败并扣分：**过期不扣分**

### 5.4 数据与统计
- [x] 是否需要数据导出功能：**不需要**
- [x] 是否需要图表展示积分趋势：**不需要复杂图表**
- [x] 统计维度的需求：**按项目维度统计积分获得情况**（用于分析和调整任务难易度）
- [x] 是否需要目标设定功能：**需要**（日/周/月目标）

### 5.5 其他功能
- [x] 是否需要数据备份与恢复：**需要**（手动+自动备份）
- [x] 是否需要密码保护/指纹解锁：**需要密码保护**
- [x] 权限管理（家长模式）：**需要**
  - 管理员：完全权限
  - 普通用户：只能查看和标记任务完成，不能编辑数据和积分
- [x] 是否需要每日签到功能：**不需要**
- [x] 是否考虑后期支持多用户/数据同步：**需要多用户支持，预留数据同步功能**

## 6. 模块化开发计划

### 开发原则
- 每个模块独立开发，可单独预览调试
- 使用 Flutter 的 Widget Preview 和独立路由进行测试
- 先完成UI界面，再接入数据逻辑
- 采用 Provider 状态管理，便于模块解耦

---

### 阶段 0: 项目初始化与基础配置（1-2天）

**目标**: 搭建项目基础架构

**任务清单**:
- [x] 创建 Flutter 项目
- [ ] 配置 pubspec.yaml，添加所需依赖
  - go_router
  - provider
  - sqflite
  - shared_preferences
  - flutter_easyloading
  - dio
  - event_bus
- [ ] 创建项目目录结构
  ```
  lib/
  ├── main.dart
  ├── app.dart
  ├── config/           # 配置文件（主题、常量）
  │   ├── theme.dart
  │   └── constants.dart
  ├── models/           # 数据模型
  ├── providers/        # 状态管理
  ├── services/         # 业务服务（数据库、API等）
  ├── widgets/          # 公共组件
  ├── pages/            # 页面
  │   ├── main/         # 主页面（含 PageView 和底部导航）
  │   ├── splash/
  │   ├── login/
  │   ├── home/
  │   ├── shop/         # 兑换商城
  │   ├── history/
  │   ├── statistics/
  │   └── settings/
  └── utils/            # 工具类
  ```
- [ ] 配置主题色（明快蓝色）
- [ ] 设置基础路由

**预览内容**: 空白项目 + 主题色预览

---

### 阶段 1: UI组件库开发（3-4天）

**目标**: 开发可复用的UI组件，建立统一视觉风格

#### 模块 1.1: 主题配置与通用组件
**文件**: `lib/config/theme.dart`, `lib/widgets/common/`

**任务**:
- [ ] 定义主题配置（颜色、字体、圆角等）
  - 主色：明快蓝色 (#42A5F5)
  - 辅助色：黄色、绿色、橙色
- [ ] 创建通用组件
  - CustomButton（可爱风格按钮）
  - CustomCard（卡片组件）
  - CustomTextField（输入框）
  - LoadingWidget（加载动画）
  - EmptyWidget（空状态展示）

**独立预览**: 创建 `lib/dev/component_preview.dart` 展示所有组件

#### 模块 1.2: 底部导航栏 + PageView
**文件**: `lib/widgets/bottom_navigation.dart`, `lib/pages/main/main_page.dart`

**任务**:
- [ ] 创建 MainPage，包含 PageView 和底部导航栏
- [ ] 创建5个Tab的底部导航栏组件
  - 首页、兑换、历史、统计、设置
- [ ] 设计图标和激活状态
- [ ] 实现 PageView 配置
  - 5个子页面（HomePage, ShopPage, HistoryPage, StatisticsPage, SettingsPage）
  - 支持左右滑动
- [ ] 实现联动逻辑
  - PageController 控制页面切换
  - 点击导航栏跳转到对应页面
  - 滑动页面时更新导航栏选中状态

**独立预览**: 创建测试页面展示导航栏切换和滑动效果

**示例代码结构**:
```dart
class MainPage extends StatefulWidget {
  @override
  _MainPageState createState() => _MainPageState();
}

class _MainPageState extends State<MainPage> {
  late PageController _pageController;
  int _currentIndex = 0;

  @override
  void initState() {
    super.initState();
    _pageController = PageController(initialPage: 0);
  }

  void _onPageChanged(int index) {
    setState(() {
      _currentIndex = index;
    });
  }

  void _onTabTapped(int index) {
    _pageController.animateToPage(
      index,
      duration: Duration(milliseconds: 300),
      curve: Curves.easeInOut,
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: PageView(
        controller: _pageController,
        onPageChanged: _onPageChanged,
        children: [
          HomePage(),
          ShopPage(),
          HistoryPage(),
          StatisticsPage(),
          SettingsPage(),
        ],
      ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: _onTabTapped,
        items: [
          // 5个 Tab 项
        ],
      ),
    );
  }
}
```

---

### 阶段 2: 启动与登录模块（2-3天）

**目标**: 完成启动页和用户登录功能

#### 模块 2.1: 启动页
**文件**: `lib/pages/splash/splash_page.dart`

**任务**:
- [ ] 设计启动页UI（Logo + 应用名称）
- [ ] 添加启动动画
- [ ] 实现自动跳转逻辑（2-3秒后）

**独立预览**: 直接运行可看到启动页效果

#### 模块 2.2: 登录注册页面
**文件**: `lib/pages/login/login_page.dart`

**任务**:
- [ ] 设计登录UI（用户名、密码输入）
- [ ] 设计注册UI（创建账户）
- [ ] 添加角色选择（管理员/普通用户）
- [ ] 表单验证逻辑

**独立预览**: 路由直接跳转到登录页测试

**数据**: 暂时使用假数据模拟登录

---

### 阶段 3: 数据库层开发（2-3天）

**目标**: 完成 SQLite 数据库设计与服务封装

#### 模块 3.1: 数据模型定义
**文件**: `lib/models/`

**任务**:
- [ ] 创建所有数据模型类
  - User（用户）
  - Project（项目）
  - Task（任务）
  - PointRecord（积分记录）
  - Reward（奖励商品，包含词汇信息）
  - Tag（标签）
  - TaskTemplate（任务模板）
  - Goal（目标）
  - UserWord（用户词汇库）
  - Exchange（兑换记录）
  - 等等...
- [ ] 实现 toMap() 和 fromMap() 方法
- [ ] Reward模型特别注意词汇相关字段：
  - wordCode（词汇代号）
  - wordType（词汇类型）
  - wordPronunciation（读音）
  - wordMeaning（含义）
  - wordExample（例句）

#### 模块 3.2: 数据库服务
**文件**: `lib/services/database/`

**任务**:
- [ ] 创建 DatabaseHelper 单例类
- [ ] 实现数据库初始化和表创建
- [ ] 为每个表创建 DAO 类
  - UserDao
  - ProjectDao
  - TaskDao
  - PointRecordDao
  - 等等...
- [ ] 实现基础 CRUD 操作

**独立测试**: 编写单元测试验证数据库操作

---

### 阶段 4: 首页模块（3-4天）

**目标**: 完成首页UI和基础功能

#### 模块 4.1: 首页UI框架
**文件**: `lib/pages/home/home_page.dart`

**任务**:
- [ ] 创建首页布局
  - 用户信息卡片
  - 积分展示卡片
  - 目标进度卡片
  - 任务列表
  - 项目快捷入口
- [ ] 使用假数据填充UI

**独立预览**: 使用假数据展示完整首页

#### 模块 4.2: 任务列表组件
**文件**: `lib/pages/home/widgets/task_list.dart`

**任务**:
- [ ] 创建任务卡片组件
- [ ] 实现任务状态展示（待完成、进行中）
- [ ] 添加优先级标识
- [ ] 实现任务进度条

**独立预览**: 单独预览任务列表组件

#### 模块 4.3: 首页数据集成
**文件**: `lib/providers/home_provider.dart`

**任务**:
- [ ] 创建 HomeProvider
- [ ] 从数据库加载用户信息
- [ ] 加载积分数据
- [ ] 加载待完成任务列表
- [ ] 实现下拉刷新

**预览**: 首页接入真实数据

---

### 阶段 5: 任务管理核心功能（4-5天）

#### 模块 5.1: 任务创建页面
**文件**: `lib/pages/task/task_create_page.dart`

**任务**:
- [ ] 设计任务创建表单
  - 任务名称、描述
  - 奖励积分
  - 任务类型选择
  - 优先级选择
  - 截止时间选择
  - 标签选择
- [ ] 权限控制（仅管理员可创建）

**独立预览**: 路由跳转到任务创建页面

#### 模块 5.2: 任务详情与编辑
**文件**: `lib/pages/task/task_detail_page.dart`

**任务**:
- [ ] 任务详情展示
- [ ] 任务进度更新
- [ ] 标记完成按钮
- [ ] 编辑按钮（管理员）
- [ ] 删除按钮（管理员）

**独立预览**: 使用假任务数据预览详情页

#### 模块 5.3: 任务状态管理
**文件**: `lib/providers/task_provider.dart`

**任务**:
- [ ] 创建 TaskProvider
- [ ] 实现任务 CRUD 操作
- [ ] 实现任务完成逻辑（自动加分）
- [ ] 连续完成天数计算
- [ ] 过期任务检测

---

### 阶段 6: 积分系统（3-4天）

#### 模块 6.1: 积分记录展示
**文件**: `lib/pages/history/history_page.dart`

**任务**:
- [ ] 设计历史记录页面UI
- [ ] 时间线展示积分变动
- [ ] 记录筛选（按类型、时间）
- [ ] 显示关联任务/项目

**独立预览**: 使用假数据预览历史页面

#### 模块 6.2: 积分服务
**文件**: `lib/services/points_service.dart`

**任务**:
- [ ] 实现积分增加方法
- [ ] 实现积分扣除方法
- [ ] 实现积分记录创建
- [ ] 计算当前总积分
- [ ] 权限验证（手动调整仅管理员）

#### 模块 6.3: 等级与称号系统
**文件**: `lib/services/level_service.dart`, `lib/services/title_service.dart`

**任务**:
- [ ] 定义等级规则（基于累计积分）
- [ ] 实现等级计算
- [ ] 定义称号数据
- [ ] 实现称号解锁逻辑
- [ ] 称号展示UI

---

### 阶段 7: 项目管理（2-3天）

#### 模块 7.1: 项目列表与创建
**文件**: `lib/pages/settings/project_management_page.dart`

**任务**:
- [ ] 项目列表展示
- [ ] 项目创建表单（名称、描述、图标、颜色）
- [ ] 项目编辑功能
- [ ] 项目删除/归档
- [ ] 权限控制（仅管理员）

**独立预览**: 项目管理页面

#### 模块 7.2: 项目Provider
**文件**: `lib/providers/project_provider.dart`

**任务**:
- [ ] 项目 CRUD 操作
- [ ] 项目关联任务查询
- [ ] 项目积分统计

---

### 阶段 8: 统计页面（3-4天）

#### 模块 8.1: 统计页面UI
**文件**: `lib/pages/statistics/statistics_page.dart`

**任务**:
- [ ] 项目维度积分统计卡片
- [ ] 任务完成率展示
- [ ] 连续完成天数排行
- [ ] 等级进度展示
- [ ] 使用简单的进度条和数值展示（不用复杂图表）

**独立预览**: 使用假数据预览统计页面

#### 模块 8.2: 统计服务
**文件**: `lib/services/statistics_service.dart`

**任务**:
- [ ] 按项目统计积分
- [ ] 计算任务完成率
- [ ] 统计连续完成记录
- [ ] 计算等级进度百分比

---

### 阶段 9: 标签与模板系统（2-3天）

#### 模块 9.1: 标签管理
**文件**: `lib/pages/settings/tag_management_page.dart`

**任务**:
- [ ] 标签列表展示
- [ ] 标签创建（名称、颜色）
- [ ] 标签编辑/删除
- [ ] 标签选择组件（用于任务创建）

#### 模块 9.2: 任务模板
**文件**: `lib/pages/settings/template_management_page.dart`

**任务**:
- [ ] 模板列表展示
- [ ] 保存任务为模板
- [ ] 从模板创建任务
- [ ] 模板编辑/删除

---

### 阶段 10: 兑换商城系统（4-5天）

#### 模块 10.1: 商城主页UI
**文件**: `lib/pages/shop/shop_page.dart`

**任务**:
- [ ] 设计商城主页布局
  - 我的积分余额显示（顶部醒目）
  - 商品分类导航（横向滑动）
  - 热门推荐区域
  - 限时特惠区域
  - 商品网格/列表展示
- [ ] 商品卡片设计
  - 商品图片
  - 商品名称
  - **词汇代号**（醒目显示）
  - 所需积分（醒目显示）
  - 参考价值（小字显示）
  - 立即兑换按钮
  - 库存标识
- [ ] 使用假数据填充UI

**独立预览**: 使用假商品数据（包含词汇）预览商城页面

#### 模块 10.2: 商品详情页
**文件**: `lib/pages/shop/product_detail_page.dart`

**任务**:
- [ ] 商品详情展示
  - 大图展示
  - 详细描述
  - 所需积分
  - 库存信息
- [ ] **词汇学习卡片**
  - 词汇代号（大字显示）
  - 词汇类型标识（成语/英文）
  - 读音/音标
  - 含义解释
  - 例句展示
  - 可爱的卡片设计
- [ ] 兑换按钮
- [ ] 积分不足提醒
- [ ] 兑换成功动画
- [ ] **兑换后词汇学习提示**

**独立预览**: 使用假商品数据预览详情页，重点测试词汇卡片展示效果

#### 模块 10.3: 兑换记录与词汇库
**文件**: `lib/pages/shop/exchange_history_page.dart`, `lib/pages/shop/my_words_page.dart`

**任务**:
- [ ] 兑换记录列表
  - 显示兑换时间、商品、积分
  - 显示学习的词汇
  - 显示兑换状态（待发放/已发放）
  - 状态筛选
- [ ] **我的词汇库页面**
  - 展示所有学过的词汇
  - 按类型分组（成语/英文）
  - 词汇卡片列表
  - 复习次数统计
  - 词汇搜索功能
  - 点击词汇查看详细信息

**独立预览**: 使用假数据预览兑换记录和词汇库

#### 模块 10.4: 商城管理（管理员）
**文件**: `lib/pages/settings/shop_management_page.dart`

**任务**:
- [ ] 商品列表展示
- [ ] 商品创建表单
  - 名称、描述、图片选择
  - 所需积分
  - 参考价值（人民币）
  - 商品分类
  - 库存设置
  - 热门/特惠标记
  - **词汇信息录入**：
    - 词汇代号
    - 词汇类型（成语/英文）
    - 读音/音标
    - 含义解释
    - 例句
- [ ] 商品编辑功能
- [ ] 商品上架/下架
- [ ] 兑换订单管理（标记为已发放）
- [ ] 权限控制（仅管理员）
- [ ] **词汇库预览**（查看所有已配置的词汇）

**独立预览**: 商品管理页面

#### 模块 10.5: 商城Provider与服务
**文件**: `lib/providers/shop_provider.dart`, `lib/services/word_service.dart`

**任务**:
- [ ] ShopProvider
  - 商品 CRUD 操作
  - 按分类查询商品
  - 热门/特惠商品查询
  - 兑换逻辑（扣除积分、创建兑换记录）
  - 积分余额验证
  - 库存管理
- [ ] WordService（词汇服务）
  - **添加用户词汇**（兑换时自动调用）
  - 查询用户词汇库
  - 词汇去重（同一词汇不重复添加）
  - 更新复习次数
  - 按类型筛选词汇
  - 词汇搜索

---

### 阶段 11: 目标设定（2天）

#### 模块 11.1: 目标管理
**文件**: `lib/pages/settings/goal_management_page.dart`

**任务**:
- [ ] 目标创建（日/周/月）
- [ ] 目标进度展示
- [ ] 目标完成提醒
- [ ] 目标编辑/删除

#### 模块 11.2: 首页目标卡片
**任务**:
- [ ] 在首页显示当前目标
- [ ] 实时更新目标进度
- [ ] 目标完成动画

---

### 阶段 12: 预支积分功能（2-3天）

#### 模块 12.1: 预支页面
**文件**: `lib/pages/advance/advance_page.dart`

**任务**:
- [ ] 预支申请表单
- [ ] 利息计算展示（月利率10%）
- [ ] 预支记录列表
- [ ] 还款功能
- [ ] 权限控制

#### 模块 12.2: 预支服务
**文件**: `lib/services/advance_service.dart`

**任务**:
- [ ] 预支金额计算
- [ ] 利息计算（单利）
- [ ] 到期提醒
- [ ] 自动还款逻辑

---

### 阶段 13: 权限管理系统（2天）

#### 模块 13.1: 权限服务
**文件**: `lib/services/permission_service.dart`

**任务**:
- [ ] 实现权限检查方法
- [ ] 管理员权限验证
- [ ] 普通用户权限限制
- [ ] 在所有需要的地方添加权限控制

#### 模块 13.2: 用户管理
**文件**: `lib/pages/settings/user_management_page.dart`

**任务**:
- [ ] 用户列表展示（仅管理员）
- [ ] 用户角色管理
- [ ] 用户信息编辑
- [ ] 用户删除

---

### 阶段 14: 设置页面完善（2-3天）

#### 模块 14.1: 个人资料
**文件**: `lib/pages/settings/profile_page.dart`

**任务**:
- [ ] 头像选择/上传
- [ ] 昵称修改
- [ ] 密码修改
- [ ] 当前等级和称号展示
- [ ] 称号切换

#### 模块 14.2: 设置主页
**文件**: `lib/pages/settings/settings_page.dart`

**任务**:
- [ ] 整合所有设置子页面
- [ ] 设置项列表
- [ ] 根据权限显示/隐藏功能
- [ ] 退出登录

---

### 阶段 15: 数据备份与恢复（2-3天）

#### 模块 15.1: 备份功能
**文件**: `lib/services/backup_service.dart`

**任务**:
- [ ] 手动备份数据库
- [ ] 自动备份（定时任务）
- [ ] 备份文件存储管理
- [ ] 备份列表展示

#### 模块 15.2: 恢复功能
**文件**: `lib/pages/settings/backup_restore_page.dart`

**任务**:
- [ ] 选择备份文件
- [ ] 备份数据预览
- [ ] 恢复确认对话框
- [ ] 恢复进度展示

---

### 阶段 16: 多用户支持与数据同步预留（2天）

#### 模块 16.1: 用户切换
**任务**:
- [ ] 用户切换功能
- [ ] 数据隔离验证
- [ ] 登录状态管理

#### 模块 16.2: 同步接口预留
**文件**: `lib/services/sync_service.dart`

**任务**:
- [ ] 定义同步接口
- [ ] 数据序列化/反序列化
- [ ] 预留 API 调用点（使用 dio）

---

### 阶段 17: 集成测试与优化（3-5天）

#### 模块 17.1: 功能集成测试
**任务**:
- [ ] 测试完整用户流程
- [ ] 测试权限控制
- [ ] 测试数据一致性
- [ ] 修复发现的bug

#### 模块 17.2: 性能优化
**任务**:
- [ ] 数据库查询优化
- [ ] 列表滚动性能优化
- [ ] 减少不必要的重建
- [ ] 图片加载优化

#### 模块 17.3: UI/UX完善
**任务**:
- [ ] 添加动画效果
- [ ] 优化交互反馈
- [ ] 统一视觉风格
- [ ] 适配不同屏幕尺寸

#### 模块 17.4: 通知提醒（可选）
**任务**:
- [ ] 任务到期提醒
- [ ] 目标完成提醒
- [ ] 连续完成鼓励

---

### 开发时间估算

**总计**: 约 46-62 天（约 2-2.5 个月）

- 阶段 0: 1-2天
- 阶段 1-2: 5-7天
- 阶段 3: 2-3天
- 阶段 4-5: 7-9天
- 阶段 6-7: 5-7天
- 阶段 8-9: 5-7天
- 阶段 10: 4-5天（包含词汇学习系统）
- 阶段 11-12: 4-5天
- 阶段 13-14: 4-5天
- 阶段 15-16: 4-5天
- 阶段 17: 3-5天

### 独立预览技巧

#### 1. 使用开发路由
创建 `lib/dev/dev_routes.dart`，定义所有模块的独立预览路由：
```dart
'/dev/components': ComponentPreviewPage(),
'/dev/login': LoginPage(),
'/dev/home': HomePage(),
'/dev/task-create': TaskCreatePage(),
// ... 其他页面
```

#### 2. 使用假数据Provider
创建 `lib/dev/mock_providers.dart`，为每个页面提供假数据：
```dart
class MockTaskProvider extends ChangeNotifier {
  List<Task> get tasks => [
    Task(id: 1, title: '完成作业', points: 10),
    Task(id: 2, title: '阅读30分钟', points: 5),
  ];
}
```

#### 3. 开发模式入口
在 `main.dart` 中添加开发模式切换：
```dart
const bool isDev = true; // 开发时设为 true

void main() {
  runApp(isDev ? DevApp() : ProductionApp());
}
```

#### 4. Widget Gallery
创建 `lib/dev/widget_gallery.dart`，展示所有自定义组件和它们的不同状态。

---

**备注**:
- 每个阶段完成后进行代码审查
- 建议使用 Git 分支管理，每个模块一个分支
- 定期合并到主分支并测试集成效果
- 可根据实际开发进度调整顺序和时间
